{"version":3,"file":"dom-router.min.js","sources":["../src/constants.js","../src/route.js","../src/router.js"],"sourcesContent":["export const cssCurrent = \"dr-current\";\nexport const cssHidden = \"dr-hidden\";\nexport const delimiter = \"/\";\nexport const empty = \"\";\nexport const hash = \"#\";\nexport const notHash = /.*#/;\nexport const render = window.requestAnimationFrame;\nexport const selectorHasHash = \"a[href^='#']\";\n","class Route {\n\tconstructor (cfg) {\n\t\tthis.hash = cfg.hash;\n\t\tthis.element = cfg.element;\n\t\tthis.trigger = cfg.trigger;\n\t\tthis.timestamp = new Date().toISOString();\n\t}\n}\n\nexport function route (cfg = {element: null, hash: \"\", trigger: null}) {\n\treturn new Route(cfg);\n}\n","import {cssCurrent, cssHidden, delimiter as slash, empty, hash, notHash, render, selectorHasHash} from \"./constants.js\";\nimport {route} from \"./route.js\";\n\nclass Router {\n\tconstructor ({active = true, callback = function () {}, css = {current: cssCurrent, hidden: cssHidden}, ctx = document.body, start = null, delimiter = slash, logging = false, stickyPos = true, stickyRoute = true, stickySearchParams = false, stop = true, storage = \"session\", storageKey = \"lastRoute\"} = {}) {\n\t\tthis.active = active;\n\t\tthis.callback = callback;\n\t\tthis.css = css;\n\t\tthis.ctx = ctx;\n\t\tthis.delimiter = delimiter;\n\t\tthis.history = [];\n\t\tthis.logging = logging;\n\t\tthis.routes = [];\n\t\tthis.stickyPos = stickyPos;\n\t\tthis.stickyRoute = stickyRoute;\n\t\tthis.stickySearchParams = stickySearchParams;\n\t\tthis.storage = storage === \"session\" ? sessionStorage : localStorage;\n\t\tthis.storageKey = storageKey;\n\t\tthis.stop = stop;\n\t\tthis.start = this.stickyRoute ? this.storage.getItem(this.storageKey) || start : start;\n\t}\n\n\tcurrent () {\n\t\treturn this.history[this.history.length - 1];\n\t}\n\n\thandler () {\n\t\tconst oldHash = this.history.length > 0 ? (this.current().hash || empty).replace(notHash, empty) || null : null,\n\t\t\tnewHash = location.hash.includes(hash) ? location.hash.replace(notHash, empty) : null;\n\n\t\tif (this.active && this.valid(newHash)) {\n\t\t\tif (!this.routes.includes(newHash)) {\n\t\t\t\tthis.route(this.routes.filter(i => i.includes(newHash))[0] || this.start);\n\t\t\t} else {\n\t\t\t\tconst y = document.body.scrollTop,\n\t\t\t\t\toldHashes = oldHash ? oldHash.split(this.delimiter) : [],\n\t\t\t\t\tnewHashes = newHash.split(this.delimiter),\n\t\t\t\t\tremove = [];\n\t\t\t\tlet oldRoute = empty;\n\n\t\t\t\tfor (const loldHash of oldHashes) {\n\t\t\t\t\toldRoute += `${oldRoute.length > 0 ? `${this.delimiter}` : empty}${loldHash}`;\n\t\t\t\t\tremove.push(...this.select(`a[href=\"#${oldRoute}\"]`));\n\t\t\t\t}\n\n\t\t\t\trender(() => {\n\t\t\t\t\tlet newEl, newTrigger;\n\n\t\t\t\t\tfor (const i of remove) {\n\t\t\t\t\t\ti.classList.remove(this.css.current);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const idx of newHashes.keys()) {\n\t\t\t\t\t\tconst nth = idx + 1,\n\t\t\t\t\t\t\tvalid = oldHashes.length >= nth,\n\t\t\t\t\t\t\toldEl = valid ? this.select(`#${oldHashes.slice(0, nth).join(\" #\")}`) : void 0,\n\t\t\t\t\t\t\toldTrigger = valid ? this.select(`a[href='#${oldHashes.slice(0, nth).join(this.delimiter)}']`) : void 0;\n\n\t\t\t\t\t\tnewEl = this.select(`#${newHashes.slice(0, nth).join(\" #\")}`);\n\t\t\t\t\t\tnewTrigger = this.select(`a[href='#${newHashes.slice(0, nth).join(this.delimiter)}']`);\n\t\t\t\t\t\tthis.load(oldTrigger, oldEl, newTrigger, newEl);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.stickyRoute) {\n\t\t\t\t\t\tthis.storage.setItem(this.storageKey, newHash);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.stickyPos) {\n\t\t\t\t\t\tdocument.body.scrollTop = y;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst r = route({\n\t\t\t\t\t\telement: newEl,\n\t\t\t\t\t\thash: newHash,\n\t\t\t\t\t\ttrigger: newTrigger\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!this.stickySearchParams) {\n\t\t\t\t\t\tconst url = new URL(location.href);\n\n\t\t\t\t\t\tfor (const key of url.searchParams.keys()) {\n\t\t\t\t\t\t\turl.searchParams.delete(key);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\thistory.replaceState({}, \"\", url.href);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.log(r);\n\t\t\t\t\tthis.callback(r);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tload (oldTrigger = [], oldEl = [], newTrigger = [], newEl = []) {\n\t\tfor (const i of oldTrigger) {\n\t\t\ti.classList.remove(this.css.current);\n\t\t}\n\n\t\tfor (const [idx, i] of oldEl.entries()) {\n\t\t\tif (i.id !== newEl[idx]?.id) {\n\t\t\t\ti.classList.add(this.css.hidden);\n\t\t\t}\n\t\t}\n\n\t\tfor (const i of newTrigger) {\n\t\t\ti.classList.add(this.css.current);\n\t\t}\n\n\t\tfor (const i of newEl) {\n\t\t\tthis.sweep(i, this.css.hidden);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tlog (arg) {\n\t\tthis.history.push(this.logging ? arg : {hash: arg.hash});\n\n\t\treturn this;\n\t}\n\n\tpopstate (ev) {\n\t\tthis.handler(ev);\n\n\t\treturn this;\n\t}\n\n\tprocess () {\n\t\tconst lhash = document.location.hash.replace(hash, empty);\n\n\t\tthis.scan(this.start);\n\n\t\tif (!this.ctx.classList.contains(this.css.hidden)) {\n\t\t\tif (lhash.length > 0 && this.routes.includes(lhash)) {\n\t\t\t\tthis.handler();\n\t\t\t} else {\n\t\t\t\tthis.route(this.start);\n\t\t\t}\n\t\t}\n\t}\n\n\troute (arg = empty) {\n\t\tconst url = new URL(location.href);\n\n\t\tif (url.hash.replace(\"#\", \"\") !== arg) {\n\t\t\turl.hash = arg;\n\t\t\thistory.pushState({}, \"\", url.href);\n\t\t\tthis.handler();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tselect (arg) {\n\t\treturn Array.from(this.ctx.querySelectorAll.call(this.ctx, arg)).filter(i => i !== null);\n\t}\n\n\tscan (input = empty) {\n\t\tconst arg = input === null ? empty : input;\n\n\t\tthis.routes = Array.from(new Set(this.select(selectorHasHash).map(i => i.href.replace(notHash, empty)).filter(i => i !== empty)));\n\n\t\tif (arg.length > 0 && !this.routes.includes(arg)) {\n\t\t\tthis.routes.push(arg);\n\t\t}\n\n\t\tthis.start = arg || this.routes[0] || null;\n\n\t\treturn this;\n\t}\n\n\tsweep (obj, klass) {\n\t\trender(() => {\n\t\t\tArray.from(obj.parentNode.childNodes).filter(i => i.nodeType === 1 && i.id && i.id !== obj.id).forEach(i => i.classList.add(klass));\n\t\t\tobj.classList.remove(klass);\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tvalid (arg = empty) {\n\t\treturn arg === empty || (/=/).test(arg) === false;\n\t}\n}\n\nexport function router (arg) {\n\tconst obj = new Router(arg);\n\n\tobj.popstate = obj.popstate.bind(obj);\n\n\tif (\"addEventListener\" in window) {\n\t\twindow.addEventListener(\"popstate\", obj.popstate, false);\n\t} else {\n\t\twindow.onpopstate = obj.popstate;\n\t}\n\n\tif (obj.active) {\n\t\tobj.process();\n\t}\n\n\treturn obj;\n}\n"],"names":["empty","notHash","render","window","requestAnimationFrame","Route","constructor","cfg","this","hash","element","trigger","timestamp","Date","toISOString","Router","active","callback","css","current","hidden","ctx","document","body","start","delimiter","logging","stickyPos","stickyRoute","stickySearchParams","stop","storage","storageKey","history","routes","sessionStorage","localStorage","getItem","length","handler","oldHash","replace","newHash","location","includes","valid","y","scrollTop","oldHashes","split","newHashes","remove","oldRoute","loldHash","push","select","newEl","newTrigger","i","classList","idx","keys","nth","oldEl","slice","join","oldTrigger","load","setItem","r","route","url","URL","href","key","searchParams","delete","replaceState","log","filter","entries","id","add","sweep","arg","popstate","ev","process","lhash","scan","contains","pushState","Array","from","querySelectorAll","call","input","Set","map","obj","klass","parentNode","childNodes","nodeType","forEach","test","exports","router","bind","addEventListener","onpopstate","Object","defineProperty","value"],"mappings":"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"}