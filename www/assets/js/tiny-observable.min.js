/* 2016 Jason Mulligan <jason.mulligan@avoidwork.com> */

"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(a){function b(a,b){return void 0!==a[b]}function c(a){return a instanceof Array?a:b(a,"length")?Array.from(a):[a]}function d(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a;Object.keys(a).forEach(function(a,d){b.call(c,a,d)})}function e(){return(65536*(Math.random()+1)|0).toString(16).substring(1)}function f(){return e()+e()+"-"+e()+"-4"+e().substr(0,3)+"-"+h[Math.floor(4*Math.random())]+e().substr(0,3)+"-"+e()+e()+e()}function g(a){return new Observable(a)}var WeakMap=a.WeakMap||require("es6-weak-map"),h=[8,9,"a","b"],Observable=function(){function Observable(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;_classCallCheck(this,Observable),this.limit=a,this.listeners={},this.hooks=new WeakMap}return _createClass(Observable,[{key:"dispatch",value:function(a){for(var c=this,e=arguments.length,f=Array(e>1?e-1:0),g=1;g<e;g++)f[g-1]=arguments[g];return a&&b(this.listeners,a)&&d(this.listeners[a],function(b){var d=c.listeners[a][b];d.handler.apply(d.scope,f)}),this}},{key:"hook",value:function(a,d){var e=this,f=c(a);return f.forEach(function(a){var c=void 0;if(!b(a,"addEventListener"))throw new Error("Invalid Arguments");c=e.hooks.get(a)||{},b(c,d)||(c[d]=function(a){e.dispatch(d,a)}),e.hooks.set(a,c),a.addEventListener(d,e.hooks.get(a)[d],!1)}),this}},{key:"off",value:function(a,c){return b(this.listeners,a)&&(c?delete this.listeners[a][c]:delete this.listeners[a]),this}},{key:"on",value:function(a,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f(),e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;if(b(this.listeners,a)||(this.listeners[a]={}),Object.keys(this.listeners[a]).length>=this.limit)throw new Error("Possible memory leak, more than "+this.limit+" listeners for event: "+a);return this.listeners[a][d]={scope:e||this,handler:c},this}},{key:"once",value:function(a,b){var c=this,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f(),e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,g=e||this;return this.on(a,function(){for(var e=arguments.length,f=Array(e),h=0;h<e;h++)f[h]=arguments[h];b.apply(g,f),c.off(a,d)},d,g)}},{key:"unhook",value:function(a,d){var e=this,f=c(a);return f.forEach(function(a){var c=void 0;if(!b(a,"removeEventListener"))throw new Error("Invalid Arguments");c=e.hooks.get(a),c&&(a.removeEventListener(d,c[d],!1),delete c[d],0===Object.keys(c).length?e.hooks.delete(a):e.hooks.set(a,c))}),this}}]),Observable}();"undefined"!=typeof exports?module.exports=g:"function"==typeof define&&define.amd?define(function(){return g}):a.observable=g}("undefined"!=typeof window?window:global);
//# sourceMappingURL=tiny-observable.min.js.map